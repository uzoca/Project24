 

<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <title>Pseudo Bank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="../img/pseudo_icon.png">
  <!-- Google fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" rel="stylesheet">
  <!-- Stylesheet -->
  <link rel="stylesheet" href="../fontawesome/css/all.min.css">
  <link rel="stylesheet" href="../css/vendor/bootstrap-4.3.1/bootstrap.min.css">
  <link rel="stylesheet" href="../css/main.css">
   <style>
   .gradient-back{
     background:linear-gradient(135deg, #000000 0%,#0f5f02 100%);
     color : #fff
   }
   </style>
</head>

<body class="position-relative">
   <div class="container">
     <div class="col-12 col-md-8 mx-auto">
        <div class="card m-md-5" >
        <!-- card start -->
           <div class="card " style="background:linear-gradient(135deg, #000000 0%,#0f5f02 100%);height: 20rem;">
            <div class="card-body"> 
            <!-- row start -->
            
             <div class="d-flex justify-content-between"><p class="text-center font-weight-bold text-white pl-2"> Welcome: <span class="acc_name_span pl-2">Testaccount1</span></p> <p><span ><a class="text-white" href="./bankpage_login.html">Logout</a></span></p></div>
              <div class="row">
               <div class="col-md-7 col-11 mx-auto">
                 <p class="font-weight-bold text-white mt-2 mb-4"> Pseudo bank acount number: <h3 class="text-white acc_number_span">098478672827</h3></p>
                 <span class="font-weight-bold text-white pl-1 ">Account Balance</span>
                 <h2 class="font-weight-bold text-white mb-3 acc_balance_span">&#8358 60,000</h4>
                 <p class="font-weight-bold text-white"> Book balance: <span class="acc_balance_span">&#8358 60,000</span></p>
               </div>
               <div class="col-md-4 col-2 mx-auto p-md-3 d-none d-md-block">
                <img src="../img/pseudo_icon_large.png">
               </div>
              </div>
              <!-- row end -->
           
            </div>
           </div>
        <!-- card end -->
            
             <div class="send-money-form p-4 " style="display: none;">
                 <div class="col-12 text-right"><button class="btn close-form">x</button></div>
                <form class="needs-validation send_money_form" novalidate>

                    <div class="row">
                    <div class="col-md-6">
                   <div class="mb-3">
                        <label for="validationCustom03" class="form-label">Select description </label>
                        <select class="form-control" name="cash_flow_type" id="validationCustom03" required>
                            <option selected disabled value="">Sending money for</option>
                              <option value="Staff Expenses"> Staff Expenses</option>
                              <option value="Utilities and Maintenance">Utilities and Maintenance</option>
                              <option value="Equipment Purchases"> Equipment Purchases</option>
                              <option value="Equipment Purchases">Insurance Payments</option>
                               <option value="Software Licenses">Software Licenses</option>
                               <option value="Professional Development">Professional Development</option>
                               <option value="Capital Projects"> Capital Projects </option>
                               <option value="Loan Payments">Loan Payments </option>
                               <option value="Extracurricular Activities">Extracurricular Activities</option>
                               <option value="Miscellaneous Expenses">	Miscellaneous Expenses</option>
                               <option value="Tuition Fees">Tuition Fees</option>
                               <option value="Registratiom Fees"> Registratiom Fees</option>
                               <option value="Facility Rentals">Facility Rentals </option>	
                               <option value="Donations"> Donations</option>
                               <option value="Grants and Scholarships">Grants and Scholarships</option>
                               <option value="School Merchandise Sales">School Merchandise Sales</option>
                               <option value="Cafeteria Sales">Cafeteria Sales </option>
                               <option value="Transportation Fees"> Transportation Fees</option>
                               <option value="Fine Payments">Fine Payments</option>
                               <option value="	Fundraisers">	Fundraisers</option>
	                           <option></option>
                        </select>
                        <!-- <div class="invalid-feedback">
                            Please enter decription on the description box if what suits you is not listed here.
                        </div> -->

                    </div>
                    </div>
                    <div class="col-md-6">
                    <div class="mb-3">
                        <label for="validationCustom02" class="form-label">Enter account number</label>
                        <input type="text" name="account_number" class="form-control" id="validationCustom02"
                            placeholder="Enter Account number"  required>
                        <div class="bank-feedback font-weight-bold">
                            
                        </div>
                    </div>
                    </div>
                    </div>
                    <div class="row">

                    <div class="col-md-4">
                    <div class="mb-3">
                        <label for="validationCustom04" class="form-label">Amount</label>
                        <input type="text" name="amount" class="form-control" id="validationCustom04"
                            placeholder=" Enter amount" required>
                        <div class="invalid-feedback">
                            Please provide a proper amount.
                        </div>
                    </div>
                    <label for="validationCustom03" class="form-label">Select bank </label>
                        <select class="form-control" name="bank_name" id="validationCustom03" required>
                            <option selected value="pseudo bank">Pseudo bank</option>
                        </select>
                    </div>

                    <div class="col-md-8">
                    <div class="mb-3">
                        <label for="validationCustom05" class="form-label"></label>
                        <textarea placeholder="Enter description " class="form-control" name="description" ></textarea>
                        
                    </div>
                    </div>
                   
                    </div>
                      
                    <!-- <div class="my-3">
                    <button class="btn gradient-back w-25" type="submit">Send</button>
                    </div> -->
                      <div class="col-12 text-center">
                        <button  type="submit" class="btn border-0 w-50 p-3 my-4 text-white" style="background:linear-gradient(135deg, #000000 0%,#0f5f02 100%);" >Send Money</button>
                      </div>
                    </form>  
             </div>
              <button id="send-moneybtn" class="btn border-0 w-50 mx-auto p-3 my-4 text-white" style="background:linear-gradient(135deg, #000000 0%,#0f5f02 100%);" >Send Money</button>
               <h5 class="font-weight-bold my-2 p-4">Transaction History</h5>
               <div class="pr-3 pl-3" style="overflow-x: hidden;">
                  <!-- Data table -->
                        <div class="table-responsive mt-3 pb-1 ">
                            <table class="table border-0" id="defaultOrderingDataTable">
                                <!-- Table head -->
                                <thead>
                                    <tr style="color:#a8a8a8 !important">
                                        <th>Id</th>
                                        <th>Name</th>
                                        <th>Amount</th>
                                        <th>Cash Flow Type</th>
                                        <th>Description</th>
                                        <th>status</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <!-- Table body -->
                                <tbody class="text-dark font-weight-bold">
                                   
                                    <tr>
                                       
                                        <td><div class="text-center"><h6 class="font-weight-bold">NO DATA</h6> </div></td>
                                        
                                    </tr>
                                    <!-- Table Data -->
                                   
                                    
                                </tbody>
                                <!-- Table footer -->
                                <tfoot>
                                    <tr  style="color:#a8a8a8 !important">
                                        <th>Id</th>
                                        <th>Name</th>
                                        <th>Amount</th>
                                        <th>Cash Flow Type</th>
                                        <th>Description</th>
                                        <th>status</th>
                                        <th>Date</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
               </div>
       </div>
     </div>
   </div>
    <script src="../js/vendor/bootstrap-4.3.1/modernizr-3.7.1.min.js"></script>
  <script src="../js/vendor/jquery-3.3.1/jquery-3.3.1.min.js"></script>
  <!-- Bootstrap -->
  <script src="../js/vendor/popper-js/popper1.14.7.js"></script>
  <script src="../js/vendor/bootstrap-4.3.1/bootstrap.min.js"></script>
  <script src="../js/plugins/sweetjs.js"></script>
  <script src="../js/main.js"></script>
    <script>
    // Sending money function====
     $(".send_money_form").on('submit',function(ev){
       ev.preventDefault()
      var formData = new FormData(ev.target)
      var sendingAmount = $("input[name='amount']").val()
      var receiver_accountNumber = $("input[name='account_number']").val()
       formData.append('send_money',getCookie('session_id'))
       var nam = $(".bank-feedback").text().split(':')
       formData.append('receiver_name',nam[1])
        Swal.fire({
                  title: 'Confirmation',
                  html: `<div class='alert'>
                   <p> You are about to send `
                   + sendingAmount +` to this account `+ receiver_accountNumber +`
                  </div>`,
                  icon: 'question',
                  confirmButtonText: 'Confirm',
                  showCancelButton: true,
                  }).then(function(result){
                    if(result.isConfirmed){
                        $.ajax({
                        method :'Post',
                        url: '../backend/backend.php',
                        data : formData,
                        processData: false,
                        contentType : false,
                        beforeSend : function(){
                        $("button[type ='submit']").html("Loadind please wait....")
                        },
                        success : function(data){
                        console.log(data)
                        if(data.indexOf('rror')!= -1){
                        Swal.fire({
                        title: 'Error!',
                        text: data,
                        icon: 'error',
                        confirmButtonText: 'Close'
                        })
                        }else{
                        Swal.fire({
                        title: '',
                        text: data,
                        icon: 'success',
                        confirmButtonText: 'Ok'
                        })
                        $("button[type ='submit']").html("Send Money")
                        }

                        }
                        })
                    
                    }
                  
                  })
 
     })

    //  Get transactions ========
    get_transactions()
    var tranTicker=  setInterval(() => {
    get_transactions()
    getAccountDetails()
    }, 2000);
  function get_transactions(){

    sendMinorData({'get_user_transaction': getCookie('session_id')},function(data){
      data = JSON.parse(data)
        $("#defaultOrderingDataTable tbody").empty()
       
     data.forEach( 
       element => {
        var statusColumn 
        if(element['type'] == 'debit'){
          statusColumn = 
        '<span class= "badge badge-outline-danger badge-pill m-1 border-0 px-3 pt-1 pb-2" style="background-color:#f3dbdb;"></i>Debit</span>'
        }else{
           statusColumn = '<span class="badge badge-outline-success badge-pill m-1 border-0 px-3 pt-1 pb-2" style="background-color:#c1f1c3 ;"></i>Credit</span>'
        }    

        $("#defaultOrderingDataTable tbody").append( "<tr><td><div style='width:40px'>"+element['id'] +"</div></td>"+
            "<td><div  style='width:80px' >"+ element['object_fullname']+"</div></td>"+
            "<td><div  style='width:60px' >"+ element['amount']+"</div></td>"+
            "<td><div style='width:100px'>"+element['flow_type']+"</div></td>"+
            "<td '><div style='width:140px'>"+element['description']+"</div></td> "+
            "<td><div style='width:80px'>"+ statusColumn +"</div></td>"+
            "<td><div style='width:80px'>"+element['date'] +"</div></td></tr>"
            )
     });
     })
}
    
     getAccountDetails()  
    //  Get bank details =======
    function getAccountDetails(){
     sendMinorData({'get_bank_details':getCookie('session_id')},function(data){
          if(data.indexOf('script') != -1){
            $('body').append(data)
          }else{
           data = JSON.parse(data)
           $(".acc_name_span").text(data['firstname']+' '+data['lastname'])
           $(".acc_number_span").text(data['acount_number'])
           $(".acc_balance_span").text(data['acount_balance'])
          }
        })
    }
       
        //  toggle send form appearance
        $("#send-moneybtn").click(function(){
            $(".send-money-form").toggle(400)
            $(this).hide()
        })

         $(".close-form").click(function(){
            $(".send-money-form").toggle(400)
              $("#send-moneybtn").show()
         })
        //  Get receiver full name=========
         $("input[name='account_number']").on('blur',function(e){
            $(".bank-feedback").text('Checking account details ....').removeClass('text-danger').addClass('text-success')
          if(e.target.value.length>9){
         
            sendMinorData({'get_accountname':e.target.value},function(data){
              $(".bank-feedback").text('')
               console.log(data)
               if(data.indexOf('Unknown') != -1){
                 $(".bank-feedback").text(data).removeClass('text-success').addClass('text-danger')
               }else{
                 data = JSON.parse(data)
                 $(".bank-feedback").html("<div> Acc name : "+ data['firstname'] +' '+ data['lastname'] +" </div>").addClass('text-success').removeClass('text-danger')
               }
             
            })
          }
         
         })
    </script>
</body>

</html>